/*
Deployment script for Database_9

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "Database_9"
:setvar DefaultFilePrefix "Database_9"
:setvar DefaultDataPath "C:\Users\talekra\AppData\Local\Microsoft\VisualStudio\SSDT\SmartBase"
:setvar DefaultLogPath "C:\Users\talekra\AppData\Local\Microsoft\VisualStudio\SSDT\SmartBase"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ARITHABORT ON,
                CONCAT_NULL_YIELDS_NULL ON,
                CURSOR_DEFAULT LOCAL 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET PAGE_VERIFY NONE,
                DISABLE_BROKER 
            WITH ROLLBACK IMMEDIATE;
    END


GO
ALTER DATABASE [$(DatabaseName)]
    SET TARGET_RECOVERY_TIME = 0 SECONDS 
    WITH ROLLBACK IMMEDIATE;


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET QUERY_STORE (CLEANUP_POLICY = (STALE_QUERY_THRESHOLD_DAYS = 367)) 
            WITH ROLLBACK IMMEDIATE;
    END


GO
PRINT N'Creating [dbo].[AccountMaster]...';


GO
CREATE TABLE [dbo].[AccountMaster] (
    [CompCode]  NCHAR (2)  NOT NULL,
    [AccYear]   NCHAR (4)  NOT NULL,
    [AccountId] NCHAR (16) NOT NULL,
    [Opening]   MONEY      NULL,
    [CurDr]     MONEY      NULL,
    [CurCr]     MONEY      NULL,
    [Closing]   MONEY      NULL,
    CONSTRAINT [PK_AccountMaster] PRIMARY KEY CLUSTERED ([CompCode] ASC, [AccYear] ASC, [AccountId] ASC)
);


GO
PRINT N'Creating [dbo].[BillDetail]...';


GO
CREATE TABLE [dbo].[BillDetail] (
    [CompCode] NCHAR (2)  NOT NULL,
    [AccYear]  NCHAR (4)  NOT NULL,
    [BillId]   NCHAR (16) NOT NULL,
    [ItemSr]   INT        NOT NULL,
    [VouNo]    NCHAR (10) NOT NULL,
    [Amount]   MONEY      NOT NULL,
    CONSTRAINT [PK_BillDetail] PRIMARY KEY CLUSTERED ([CompCode] ASC, [AccYear] ASC, [BillId] ASC, [ItemSr] ASC)
);


GO
PRINT N'Creating [dbo].[BillMaster]...';


GO
CREATE TABLE [dbo].[BillMaster] (
    [CompCode]  NCHAR (2)  NOT NULL,
    [AccYear]   NCHAR (4)  NOT NULL,
    [BillId]    NCHAR (16) NOT NULL,
    [AccountId] NCHAR (16) NOT NULL,
    [BillDate]  DATE       NOT NULL,
    [Amount]    MONEY      NOT NULL,
    [Adjusted]  MONEY      NULL,
    [Balance]   MONEY      NULL,
    CONSTRAINT [PK_BillMaster_1] PRIMARY KEY CLUSTERED ([CompCode] ASC, [AccYear] ASC, [BillId] ASC)
);


GO
PRINT N'Creating [dbo].[CgstMaster]...';


GO
CREATE TABLE [dbo].[CgstMaster] (
    [CgstId]     INT           NOT NULL,
    [CgstDetail] NVARCHAR (50) NOT NULL,
    [CgstRate]   MONEY         NOT NULL,
    CONSTRAINT [PK_CgstMaster] PRIMARY KEY CLUSTERED ([CgstId] ASC)
);


GO
PRINT N'Creating [dbo].[CompInfo]...';


GO
CREATE TABLE [dbo].[CompInfo] (
    [CompCode]    NCHAR (2)     NOT NULL,
    [AccYear]     NCHAR (4)     NOT NULL,
    [Name]        NVARCHAR (50) NOT NULL,
    [YearBegin]   DATE          NOT NULL,
    [YearEnd]     DATE          NOT NULL,
    [TaxId]       NVARCHAR (50) NULL,
    [AutoVoucher] NCHAR (1)     NULL,
    [BillMatch]   NCHAR (1)     NULL,
    [Address]     NCHAR (50)    NULL,
    CONSTRAINT [PK_CompInfo] PRIMARY KEY CLUSTERED ([CompCode] ASC, [AccYear] ASC)
);


GO
PRINT N'Creating [dbo].[Ledger]...';


GO
CREATE TABLE [dbo].[Ledger] (
    [CompCode]      NCHAR (2)  NULL,
    [AccYear]       NCHAR (4)  NULL,
    [VouNo]         NCHAR (10) NULL,
    [VouDate]       DATE       NULL,
    [ItemSr]        INT        NOT NULL,
    [AccountId]     NCHAR (16) NULL,
    [DrCr]          NCHAR (1)  NULL,
    [Amount]        MONEY      NULL,
    [CorrAccountId] NCHAR (16) NULL,
    [VouDetail]     NCHAR (10) NULL,
    CONSTRAINT [PK_Ledger] PRIMARY KEY CLUSTERED ([ItemSr] ASC)
);


GO
PRINT N'Creating [dbo].[SgstMaster]...';


GO
CREATE TABLE [dbo].[SgstMaster] (
    [SgstId]     INT           NOT NULL,
    [SgstDetail] NVARCHAR (50) NOT NULL,
    [SgstRate]   MONEY         NOT NULL,
    CONSTRAINT [PK_SgstMaster] PRIMARY KEY CLUSTERED ([SgstId] ASC)
);


GO
PRINT N'Creating [dbo].[TransactionMaster]...';


GO
CREATE TABLE [dbo].[TransactionMaster] (
    [TrxId]      NCHAR (1)     NOT NULL,
    [DrCr]       NCHAR (1)     NOT NULL,
    [TrxDetail]  NVARCHAR (50) NULL,
    [AccountId1] NCHAR (16)    NULL,
    [AccountId2] NCHAR (16)    NULL,
    [AccountId3] NCHAR (16)    NULL,
    CONSTRAINT [PK_TransactionMaster] PRIMARY KEY CLUSTERED ([TrxId] ASC)
);


GO
PRINT N'Creating [dbo].[TypeMaster]...';


GO
CREATE TABLE [dbo].[TypeMaster] (
    [CompCode]  NCHAR (2)     NOT NULL,
    [AccYear]   NCHAR (4)     NOT NULL,
    [TrxCd]     NCHAR (1)     NOT NULL,
    [TrxDetail] NVARCHAR (50) NOT NULL,
    [Prefix]    NCHAR (4)     NOT NULL,
    [ItemSr]    INT           NULL,
    CONSTRAINT [PK_TypeMaster] PRIMARY KEY CLUSTERED ([CompCode] ASC, [AccYear] ASC, [TrxCd] ASC)
);


GO
PRINT N'Creating [dbo].[UserInfo]...';


GO
CREATE TABLE [dbo].[UserInfo] (
    [CompCode]     NCHAR (2)     NOT NULL,
    [UserName]     NCHAR (25)    NOT NULL,
    [UserEmailId]  NVARCHAR (50) NULL,
    [UserPassword] NVARCHAR (50) NOT NULL,
    CONSTRAINT [PK_UserInfo_1] PRIMARY KEY CLUSTERED ([UserName] ASC)
);


GO
PRINT N'Creating [dbo].[VoucherDetail]...';


GO
CREATE TABLE [dbo].[VoucherDetail] (
    [CompCode]  NCHAR (2)     NOT NULL,
    [AccYear]   NCHAR (4)     NOT NULL,
    [VouNo]     NCHAR (10)    NOT NULL,
    [ItemSr]    INT           NOT NULL,
    [AccountId] NCHAR (16)    NOT NULL,
    [DrCr]      NCHAR (1)     NOT NULL,
    [Amount]    MONEY         NOT NULL,
    [VouDetail] NVARCHAR (50) NULL,
    CONSTRAINT [PK_VoucherDetail] PRIMARY KEY CLUSTERED ([CompCode] ASC, [AccYear] ASC, [VouNo] ASC, [ItemSr] ASC)
);


GO
PRINT N'Creating [dbo].[VoucherMaster]...';


GO
CREATE TABLE [dbo].[VoucherMaster] (
    [CompCode]   NCHAR (2)     NOT NULL,
    [AccYear]    NCHAR (4)     NOT NULL,
    [VouNo]      NCHAR (10)    NOT NULL,
    [VouDate]    DATE          NOT NULL,
    [TrxType]    NCHAR (1)     NOT NULL,
    [BilChq]     NVARCHAR (15) NULL,
    [BillId]     NCHAR (16)    NULL,
    [AccountId]  NCHAR (16)    NOT NULL,
    [DrCr]       NCHAR (1)     NOT NULL,
    [VouDetail]  NVARCHAR (50) NULL,
    [NetAmount]  MONEY         NULL,
    [SgstId]     INT           NULL,
    [SgstAmount] MONEY         NULL,
    [CgstId]     INT           NULL,
    [CgstAmount] MONEY         NULL,
    CONSTRAINT [PK_VoucherMaster] PRIMARY KEY CLUSTERED ([CompCode] ASC, [AccYear] ASC, [VouNo] ASC)
);


GO
PRINT N'Creating [dbo].[FK_BillDetail_BillMaster]...';


GO
ALTER TABLE [dbo].[BillDetail] WITH NOCHECK
    ADD CONSTRAINT [FK_BillDetail_BillMaster] FOREIGN KEY ([CompCode], [AccYear], [BillId]) REFERENCES [dbo].[BillMaster] ([CompCode], [AccYear], [BillId]);


GO
PRINT N'Creating [dbo].[FK_Ledger_VoucherMaster]...';


GO
ALTER TABLE [dbo].[Ledger] WITH NOCHECK
    ADD CONSTRAINT [FK_Ledger_VoucherMaster] FOREIGN KEY ([CompCode], [AccYear], [VouNo]) REFERENCES [dbo].[VoucherMaster] ([CompCode], [AccYear], [VouNo]);


GO
PRINT N'Creating [dbo].[FK_TypeMaster_TransactionMaster]...';


GO
ALTER TABLE [dbo].[TypeMaster] WITH NOCHECK
    ADD CONSTRAINT [FK_TypeMaster_TransactionMaster] FOREIGN KEY ([TrxCd]) REFERENCES [dbo].[TransactionMaster] ([TrxId]);


GO
PRINT N'Creating [dbo].[FK_VoucherDetail_AccountMaster]...';


GO
ALTER TABLE [dbo].[VoucherDetail] WITH NOCHECK
    ADD CONSTRAINT [FK_VoucherDetail_AccountMaster] FOREIGN KEY ([CompCode], [AccYear], [AccountId]) REFERENCES [dbo].[AccountMaster] ([CompCode], [AccYear], [AccountId]);


GO
PRINT N'Creating [dbo].[FK_VoucherDetail_VoucherMaster]...';


GO
ALTER TABLE [dbo].[VoucherDetail] WITH NOCHECK
    ADD CONSTRAINT [FK_VoucherDetail_VoucherMaster] FOREIGN KEY ([CompCode], [AccYear], [VouNo]) REFERENCES [dbo].[VoucherMaster] ([CompCode], [AccYear], [VouNo]);


GO
PRINT N'Creating [dbo].[FK_VoucherMaster_AccountMaster]...';


GO
ALTER TABLE [dbo].[VoucherMaster] WITH NOCHECK
    ADD CONSTRAINT [FK_VoucherMaster_AccountMaster] FOREIGN KEY ([CompCode], [AccYear], [AccountId]) REFERENCES [dbo].[AccountMaster] ([CompCode], [AccYear], [AccountId]);


GO
PRINT N'Creating [dbo].[FK_VoucherMaster_BillMaster]...';


GO
ALTER TABLE [dbo].[VoucherMaster] WITH NOCHECK
    ADD CONSTRAINT [FK_VoucherMaster_BillMaster] FOREIGN KEY ([CompCode], [AccYear], [BillId]) REFERENCES [dbo].[BillMaster] ([CompCode], [AccYear], [BillId]);


GO
PRINT N'Creating [dbo].[FK_VoucherMaster_CgstMaster]...';


GO
ALTER TABLE [dbo].[VoucherMaster] WITH NOCHECK
    ADD CONSTRAINT [FK_VoucherMaster_CgstMaster] FOREIGN KEY ([CgstId]) REFERENCES [dbo].[CgstMaster] ([CgstId]);


GO
PRINT N'Creating [dbo].[FK_VoucherMaster_CompInfo]...';


GO
ALTER TABLE [dbo].[VoucherMaster] WITH NOCHECK
    ADD CONSTRAINT [FK_VoucherMaster_CompInfo] FOREIGN KEY ([CompCode], [AccYear]) REFERENCES [dbo].[CompInfo] ([CompCode], [AccYear]);


GO
PRINT N'Creating [dbo].[FK_VoucherMaster_SgstMaster]...';


GO
ALTER TABLE [dbo].[VoucherMaster] WITH NOCHECK
    ADD CONSTRAINT [FK_VoucherMaster_SgstMaster] FOREIGN KEY ([SgstId]) REFERENCES [dbo].[SgstMaster] ([SgstId]);


GO
PRINT N'Creating [dbo].[FK_VoucherMaster_TypeMaster]...';


GO
ALTER TABLE [dbo].[VoucherMaster] WITH NOCHECK
    ADD CONSTRAINT [FK_VoucherMaster_TypeMaster] FOREIGN KEY ([CompCode], [AccYear], [TrxType]) REFERENCES [dbo].[TypeMaster] ([CompCode], [AccYear], [TrxCd]);


GO
PRINT N'Checking existing data against newly created constraints';


GO
USE [$(DatabaseName)];


GO
ALTER TABLE [dbo].[BillDetail] WITH CHECK CHECK CONSTRAINT [FK_BillDetail_BillMaster];

ALTER TABLE [dbo].[Ledger] WITH CHECK CHECK CONSTRAINT [FK_Ledger_VoucherMaster];

ALTER TABLE [dbo].[TypeMaster] WITH CHECK CHECK CONSTRAINT [FK_TypeMaster_TransactionMaster];

ALTER TABLE [dbo].[VoucherDetail] WITH CHECK CHECK CONSTRAINT [FK_VoucherDetail_AccountMaster];

ALTER TABLE [dbo].[VoucherDetail] WITH CHECK CHECK CONSTRAINT [FK_VoucherDetail_VoucherMaster];

ALTER TABLE [dbo].[VoucherMaster] WITH CHECK CHECK CONSTRAINT [FK_VoucherMaster_AccountMaster];

ALTER TABLE [dbo].[VoucherMaster] WITH CHECK CHECK CONSTRAINT [FK_VoucherMaster_BillMaster];

ALTER TABLE [dbo].[VoucherMaster] WITH CHECK CHECK CONSTRAINT [FK_VoucherMaster_CgstMaster];

ALTER TABLE [dbo].[VoucherMaster] WITH CHECK CHECK CONSTRAINT [FK_VoucherMaster_CompInfo];

ALTER TABLE [dbo].[VoucherMaster] WITH CHECK CHECK CONSTRAINT [FK_VoucherMaster_SgstMaster];

ALTER TABLE [dbo].[VoucherMaster] WITH CHECK CHECK CONSTRAINT [FK_VoucherMaster_TypeMaster];


GO
PRINT N'Update complete.';


GO
